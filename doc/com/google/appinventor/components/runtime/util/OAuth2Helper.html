<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_101) on Fri Jun 16 12:32:02 PDT 2017 -->
<title>OAuth2Helper</title>
<meta name="date" content="2017-06-16">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="OAuth2Helper";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":9,"i2":10,"i3":10,"i4":10,"i5":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OAuth2Helper.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/google/appinventor/components/runtime/util/NanoHTTPD.Response.html" title="class in com.google.appinventor.components.runtime.util"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../com/google/appinventor/components/runtime/util/OnInitializeListener.html" title="interface in com.google.appinventor.components.runtime.util"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/google/appinventor/components/runtime/util/OAuth2Helper.html" target="_top">Frames</a></li>
<li><a href="OAuth2Helper.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.google.appinventor.components.runtime.util</div>
<h2 title="Class OAuth2Helper" class="title">Class OAuth2Helper</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.google.appinventor.components.runtime.util.OAuth2Helper</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">OAuth2Helper</span>
extends java.lang.Object</pre>
<div class="block">This helper class uses AccountManager to handle OAuth 2.0 authorization,
 returning an access_token that is needed for Fusiontables requests.  The
 helper contains no reference to Fusiontables, so perhaps it can be 
 generalized to handle OAuth for other Google APIs.</div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>rmorelli
 
 This follows examples in the Google API Client libraries, especially the 
 tasks-android-sample and the fusiontables-commandline-sample.
 
 Here's an good overview:
 https://developers.google.com/accounts/docs/OAuth2
 
 Here's how it works.
 
 Access by an app (a client) to an shared resource (a fusiontable) requires
 the app to obtain an access token.  The access token must be attached in
 the Http request header for every query to the shared resource. The access
 token is usually valid for 1 hour and then it must be refreshed.
 
 In order to obtain access to the resource the app must use an API key. This
 is obtained by registering through your Google API console. 
 
 Google AccountManager will manage the request for the access token, hiding 
 most of the details. There are two cases:
 
   1) The app has stored the user's account name and the user is already
   logged in to a Google account.  In this case AccountManager uses the 
   account to obtain an access token.
   
   2) The app has not yet stored the user's account name.  In this case
   the AccountManager uses "features" to obtain the token, prompting the
   user to choose an account if there are more than one on the phone.
   
 In either case OAuthHelper saves the user's account name and acquired
 access token (called, traditionally, authToken) in shared preferences. 
 
 Access/Refresh Token
 
 If an expired access token is passed to a fusiontables query, the 
 query will be rejected with a 401 error. In that case, the app must
 get a fresh token.  This can be done by using a 'refresh token'.  
 But it can also be done more simply by discarding the saved access 
 token and acquiring a fresh one for each query.  That's the approach 
 taken here.
 
 Comments in the code provide the details.</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#errorMessage">errorMessage</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#PREF_ACCOUNT_NAME">PREF_ACCOUNT_NAME</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#PREF_AUTH_TOKEN">PREF_AUTH_TOKEN</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#TAG">TAG</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#OAuth2Helper--">OAuth2Helper</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private &lt;any&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#getAccountManagerResult-Activity-GoogleCredential-java.lang.String-java.lang.String-">getAccountManagerResult</a></span>(Activity&nbsp;activity,
                       GoogleCredential&nbsp;credential,
                       java.lang.String&nbsp;authTokenType,
                       java.lang.String&nbsp;accountName)</code>
<div class="block">An AccountManagerFuture represents the result of an asynchronous AccountManager call.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#getErrorMessage--">getErrorMessage</a></span>()</code>
<div class="block">Clients can retrieve error messages statically.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#getRefreshedAuthToken-Activity-java.lang.String-">getRefreshedAuthToken</a></span>(Activity&nbsp;activity,
                     java.lang.String&nbsp;authTokenType)</code>
<div class="block">Uses account manager to return a fresh authToken of authTokenType</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#isUiThread--">isUiThread</a></span>()</code>
<div class="block">Returns true if run on the UI thread.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#persistCredentials-SharedPreferences-java.lang.String-java.lang.String-">persistCredentials</a></span>(SharedPreferences&nbsp;settings,
                  java.lang.String&nbsp;accountName,
                  java.lang.String&nbsp;authToken)</code>
<div class="block">Remember the account name and authToken in prefs.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/google/appinventor/components/runtime/util/OAuth2Helper.html#resetAccountCredential-Activity-">resetAccountCredential</a></span>(Activity&nbsp;activity)</code>
<div class="block">Forget the account name and authToken.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="TAG">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>TAG</h4>
<pre>public static final&nbsp;java.lang.String TAG</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#com.google.appinventor.components.runtime.util.OAuth2Helper.TAG">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PREF_AUTH_TOKEN">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PREF_AUTH_TOKEN</h4>
<pre>public static final&nbsp;java.lang.String PREF_AUTH_TOKEN</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#com.google.appinventor.components.runtime.util.OAuth2Helper.PREF_AUTH_TOKEN">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PREF_ACCOUNT_NAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PREF_ACCOUNT_NAME</h4>
<pre>public static final&nbsp;java.lang.String PREF_ACCOUNT_NAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#com.google.appinventor.components.runtime.util.OAuth2Helper.PREF_ACCOUNT_NAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="errorMessage">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>errorMessage</h4>
<pre>private static&nbsp;java.lang.String errorMessage</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="OAuth2Helper--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>OAuth2Helper</h4>
<pre>public&nbsp;OAuth2Helper()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getRefreshedAuthToken-Activity-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRefreshedAuthToken</h4>
<pre>public&nbsp;java.lang.String&nbsp;getRefreshedAuthToken(Activity&nbsp;activity,
                                              java.lang.String&nbsp;authTokenType)</pre>
<div class="block">Uses account manager to return a fresh authToken of authTokenType</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>activity</code> - </dd>
<dd><code>authTokenType</code> - a service such as "fusiontables"</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an access token string that must be added to the OAuth header in all 
   resource queries, or null if something goes wrong.</dd>
</dl>
</li>
</ul>
<a name="getAccountManagerResult-Activity-GoogleCredential-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getAccountManagerResult</h4>
<pre>private&nbsp;&lt;any&gt;&nbsp;getAccountManagerResult(Activity&nbsp;activity,
                                      GoogleCredential&nbsp;credential,
                                      java.lang.String&nbsp;authTokenType,
                                      java.lang.String&nbsp;accountName)</pre>
<div class="block">An AccountManagerFuture represents the result of an asynchronous AccountManager call. 
 The result can only be retrieved using method get when the call has completed, 
 blocking if necessary until it is ready.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>activity</code> - </dd>
<dd><code>credential</code> - </dd>
<dd><code>authTokenType</code> - </dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a Bundle containing the result of the call, possibly null</dd>
</dl>
</li>
</ul>
<a name="isUiThread--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isUiThread</h4>
<pre>private&nbsp;boolean&nbsp;isUiThread()</pre>
<div class="block">Returns true if run on the UI thread. OAuth requests should not be made on the UI thread.</div>
</li>
</ul>
<a name="persistCredentials-SharedPreferences-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persistCredentials</h4>
<pre>private&nbsp;void&nbsp;persistCredentials(SharedPreferences&nbsp;settings,
                                java.lang.String&nbsp;accountName,
                                java.lang.String&nbsp;authToken)</pre>
<div class="block">Remember the account name and authToken in prefs.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>accountName</code> - </dd>
<dd><code>authToken</code> - </dd>
</dl>
</li>
</ul>
<a name="resetAccountCredential-Activity-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>resetAccountCredential</h4>
<pre>public static&nbsp;void&nbsp;resetAccountCredential(Activity&nbsp;activity)</pre>
<div class="block">Forget the account name and authToken.  With no account name the app will prompt 
 the user to select a new account. This method is mostly used for testing purposes.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>activity</code> - </dd>
</dl>
</li>
</ul>
<a name="getErrorMessage--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getErrorMessage</h4>
<pre>public static&nbsp;java.lang.String&nbsp;getErrorMessage()</pre>
<div class="block">Clients can retrieve error messages statically.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>errorMessage</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/OAuth2Helper.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/google/appinventor/components/runtime/util/NanoHTTPD.Response.html" title="class in com.google.appinventor.components.runtime.util"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../com/google/appinventor/components/runtime/util/OnInitializeListener.html" title="interface in com.google.appinventor.components.runtime.util"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/google/appinventor/components/runtime/util/OAuth2Helper.html" target="_top">Frames</a></li>
<li><a href="OAuth2Helper.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
